# THREE.js 错误修复总结

## 问题描述
您的项目遇到了以下错误：
1. `Uncaught ReferenceError: THREE is not defined`
2. `Uncaught TypeError: Cannot set properties of undefined (setting 'aspect')`

## 问题原因分析

### 1. THREE.js 库加载问题
- **原因**: CDN 链接不稳定或版本不匹配
- **表现**: THREE 对象未定义，导致所有依赖 THREE.js 的代码无法运行

### 2. 初始化顺序问题
- **原因**: 事件监听器在场景初始化之前设置，导致 `onWindowResize` 函数在 `camera` 和 `renderer` 未初始化时被调用
- **表现**: 尝试设置未定义对象的属性时出错

## 修复方案

### 1. 更新 CDN 链接 (index.html)
```html
<!-- 修复前 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r157/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r157/examples/js/controls/OrbitControls.js"></script>

<!-- 修复后 -->
<script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/controls/OrbitControls.js"></script>
```

### 2. 添加安全检查 (main.js)
```javascript
// 修复前
function onWindowResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

// 修复后
function onWindowResize() {
    if (camera && renderer) {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }
}
```

### 3. 调整初始化顺序 (main.js)
```javascript
// 修复前
function init() {
    setupEventListeners();
    initScene();
}

// 修复后
function init() {
    initScene();
    setupEventListeners();
}
```

## 技术说明

### CDN 选择建议
1. **jsDelivr** (`cdn.jsdelivr.net`) - 推荐使用，稳定性好
2. **unpkg** (`unpkg.com`) - 备选方案
3. **cdnjs** (`cdnjs.cloudflare.com`) - 可能存在版本同步问题

### 最佳实践
1. **防御性编程**: 在使用对象之前检查其是否存在
2. **正确的初始化顺序**: 先初始化核心对象，再设置事件监听器
3. **错误处理**: 添加 try-catch 块来捕获和处理潜在错误

## 验证方法
访问 `http://localhost:8080` 应该能够正常看到：
- 十五个彩色小球在 3D 空间中跳跃
- 可以使用鼠标控制视角
- 控制面板功能正常

## 如果仍有问题
如果问题持续存在，请检查：
1. 浏览器控制台是否有其他错误信息
2. 网络连接是否正常
3. 浏览器是否支持 WebGL

## 项目运行
```bash
npm start
# 或
npx http-server -p 8080
```

然后在浏览器中访问 `http://localhost:8080`